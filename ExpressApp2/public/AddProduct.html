<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
	  <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="open-iconic-master/font/css/open-iconic-bootstrap.css">
  </head>

  <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
      <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Company name</a>
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="#">Sign out</a>
        </li>
      </ul>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <span data-feather="home"></span>
                  Главная <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file"></span>
                  Заказы
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="shopping-cart"></span>
                  Товары
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="users"></span>
                  Клиенты
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                  Отчёты
                </a>
              </li>
            </ul>

          </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Добавление товара</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button class="btn btn-sm btn-outline-secondary">Share</button>
                <button class="btn btn-sm btn-outline-secondary">Export</button>
              </div>
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <span data-feather="calendar"></span>
                This week
              </button>
            </div>
          </div>

		  <div class="mb-3">
		  	<button type="button" id="submit" class="btn btn-success mr-2">Добавить товар</button>
		  </div>

		  <div>
		  	<form id="insertForm">
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="alb_name">Название альбома</label>
              <input type="text" class="form-control" id="alb_name">
            </div>
            <div class="form-group col-md-4">
              <label for="inputAuthor">Автор</label>
              <select id="inputAuthor" class="form-control" placeholder="fddsf">
                <option>орпорп</option>
                <option>...</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="inputGenre">Жанр</label>
              <select id="inputGenre" class="form-control">
                <option>орпорп</option>
                <option>...</option>
              </select>
            </div>
            <div class="form-group col-md-3">
              <label for="inputStyle">Стиль</label>
              <select id="inputStyle" class="form-control">
                <option>орпорп</option>
                <option>...</option>
              </select>
            </div>
            <div class="form-group col-md-3">
              <label for="inputLabel">Лейбл</label>
              <select id="inputLabel" class="form-control">
                <option>орпорп</option>
                <option>...</option>
              </select>
            </div>
            <div class="form-group col-md-3">
              <label for="inputOrigin">Происхождение</label>
              <select id="inputOrigin" class="form-control">
                <option>орпорп</option>
                <option>...</option>
              </select>
            </div>
          </div>

          <h4>Типы и количество дисков</h4>
          <div class="form-row">
            <div class="form-group col-md-4"> 
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="disktype1">
                  <label class="form-check-label" for="disktype1">
                    CD
                  </label>
                </div>
                  <label for="inputCountdisk1">Дисков в альбоме</label>
                  <input type="text" class="form-control" id="inputCountdisk1">
                  <label for="inputCount1">Дисков на складе</label>
                  <input type="text" class="form-control" id="inputCount1">
                  <label for="inputAlb_price1">Цена</label>
                  <input type="text" class="form-control" id="inputAlb_price1">
              </div>

            <div class="form-group col-md-4"> 
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="disktype2">
                  <label class="form-check-label" for="disktype2">
                    Винил
                  </label>
                </div>
                  <label for="inputCountdisk2">Дисков в альбоме</label>
                  <input type="text" class="form-control" id="inputCountdisk2">
                  <label for="inputCount2">Дисков на складе</label>
                  <input type="text" class="form-control" id="inputCount2">
                  <label for="inputAlb_price2">Цена</label>
                  <input type="text" class="form-control" id="inputAlb_price2">
              </div>
              <div class="form-group col-md-3 mt-md-4">
                <label for="inputProdtype">Тип товара</label>
                <select id="inputProdtype" class="form-control">
                <option>орпорп</option>
                <option>...</option>
              </select>
              </div>
          </div>
          <div id="songs">
            <p>
              <button class="btn btn-primary mr-2 mb-2 mb-md-0" type="button" data-toggle="collapse" data-target="#collapseSongs" aria-expanded="false" aria-controls="collapseSongs">
                Редактировать список песен
              </button>
              <button class="btn btn-primary mb-2 mb-md-0" type="button" data-toggle="collapse" data-target="#collapseImages" aria-expanded="false" aria-controls="collapseImages">
                Редактировать изображения
              </button>
            </p>
            <div class="collapse" id="collapseSongs">
              <div class="card card-body py-2 mb-2">
                <h5>Песни</h5>
                <div class="mb-3">
                  <button type="button" id="add" class="btn btn-success btn-sm mr-2" data-toggle="collapse" data-target="#addSong" aria-expanded="false" aria-controls="addSong">Добавить</button>
                  <button type="button" id="edit" class="btn btn-warning btn-sm mr-2" data-toggle="collapse" data-target="#addSong" aria-expanded="false" aria-controls="addSong">Редактировать</button>
                  <button type="button" id="delete" class="btn btn-danger btn-sm">Удалить</button>
                    <div class="collapse  mt-2" id="addSong">
                      <div class="border rounded p-1">
                        <div class="row align-items-center">
                          <div class="col-auto">
                            <button type="button" id="insertIntoTable" class="btn btn-success btn-sm" style="display: none;">Вставить в таблицу</button>
                            <button type="button" id="updateEntry" id-entry="-1" class="btn btn-success btn-sm" style="display: none;">Обновить строку</button>
                          </div>
                          <div class="col-auto">
                            <input type="text" id="songName" class="form-control-sm" placeholder="Название">
                          </div>
                          <div class="col-auto mt-1 mt-md-1 mt-lg-0">
                            <input type="text" id="songMin" class="form-control-sm" placeholder="Минуты">
                          </div>
                          <div class="col-auto mt-1 mt-md-1 mt-lg-0">
                            <input type="text" id="songSec" class="form-control-sm" placeholder="Секунды">
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                <table class="table table-bordered mb-0 table-sm">
                  <thead>
                    <tr id-entry="-1">
                      <th scope="col">#</th>
                      <th scope="col">Название</th>
                      <th scope="col">Длительность</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr id-entry="1">
                      <th scope="row" >1</th>
                      <td>Mark</td>
                      <td>12:02</td>
                    </tr>
                    <tr id-entry="2">
                      <th scope="row">2</th>
                      <td>Jacob</td>
                      <td>3:21</td>
                    </tr>
                    <tr id-entry="3">
                      <th scope="row">3</th>
                      <td>Larry</td>
                      <td>5:54</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </form>

        <div class="collapse" id="collapseImages">
          <div class="card card-body py-2 mb-2">

            <h5>Изображения</h5>
            <div class="row">
              <div class="col-12 col-md-6">
                <h6>Обложка альбома</h6>

                <img src="albums-img/1/1/0889854699123.jpg" alt="Нет изображения" id="ImageCover" class="alb-cover border d-inline-block mb-2">

                <div class="d-inline-block align-top">
                  
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">Загрузить</span>
                      </div>
                      <div class="custom-file">
                        <input type="file" class="custom-file-input" id="fileImageCover" accept="image/jpeg,image/png">
                        <label class="custom-file-label" for="fileImageCover">Выбрать файл</label>
                      </div>
                    </div>
                    <div class="text-center">
                      <button type="button" class="btn btn-danger mt-2" id="deleteImageCover">Удалить <span class="oi oi-trash"></button>
                      <button type="button" class="btn btn-danger mt-2" id="deleteIm">Удалить2 <span class="oi oi-trash"></button>
                    </div>
                  
                </div>
              </div>
              <div class="col-12 col-md-6">
                <h6>Дополнительные фотографии</h6>
                <div class="d-inline-block mb-2">
                  <div id="carouselAdditionalImages" class="carousel slide alb-cover border" data-ride="carousel">
                    <ol class="carousel-indicators">
                      <li data-target="#carouselAdditionalImages" data-slide-to="0" class="active"></li>
                      <li data-target="#carouselAdditionalImages" data-slide-to="1"></li>
                      <li data-target="#carouselAdditionalImages" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                      <div class="carousel-item active">
                        <img class="d-block w-100" src="albums-img/1/1/0889854699123.jpg" alt="First slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="albums-img/1/1/0889854699123.jpg" alt="Second slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="albums-img/1/1/0889854699123.jpg" alt="Third slide">
                      </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselAdditionalImages" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselAdditionalImages" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
                </div>
                <div class="d-inline-block align-top">
                  
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <button class="btn btn-outline-danger" id="deleteImageAdditionals" type="button">Удалить <span class="oi oi-trash"></button>
                      </div>
                      <select class="custom-select" id="inputGroupSelectImgNames">
                        <option class="imgName" selected>Изображений нет</option>
                      </select>
                    </div>
                    <div class="input-group mt-2">
                      <div class="input-group-prepend">
                        <span class="input-group-text">Загрузить</span>
                      </div>
                      <div class="custom-file">
                        <input type="file" class="custom-file-input" id="fileImageAdditions" multiple="true">
                        <label class="custom-file-label" for="fileImageAdditions">Выбрать файл</label>
                      </div>
                    </div>
                  
                </div>
              </div>
            </div>
            
          </div>
        </div>
          
        
		  </div>
          
        </main>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
    <script type="text/javascript">
    //Вставить строку
      $(function(){
        $('#insertIntoTable').bind('click', function(e){
          $('tr').last().after(`<tr id-entry="${$('tr').length}"><th scope="row">${$('tr').length}</th><td>${$('#songName').val()}</td><td>${$('#songMin').val()}:${$('#songSec').val()}</td></tr>`);
        });
      });
      //Обновить строку
      $(function(){
        $('#updateEntry').bind('click', function(e){
          if($(this).attr('id-entry')!=-1)
          {
            var curPosChildren=$("tr[id-entry="+$(this).attr('id-entry')+"]").children();
            curPosChildren[1].innerText=$('#songName').val();
            curPosChildren[2].innerText=`${$('#songMin').val()}:${$('#songSec').val()}`;
            //$(this).attr('id-entry','-1');
          }
        });
      });

      $('#submit').bind('click', function(e){
        var number=[];
        var name=[];
        var duration=[];
        $('tr').each(function(index, elem){     
            var k=1;
            for(var i in elem.childNodes)
            {
              if(k==1&&elem.childNodes[i] !== undefined)
              {
                number.push(elem.childNodes[i].innerText);
                k++;
              }
              if(k==2&&elem.childNodes[i] !== undefined)
              {
                name.push(elem.childNodes[i].innerText);
                k++;
              }
              if(k==3&&elem.childNodes[i] !== undefined)
              {
                duration.push(elem.childNodes[i].innerText);
                k++;
              }                   
            }  
        });
        for(var i=1;i<number.length;i++)
        {
          $('#insertForm').append("<input type='hidden' name='number[]' value='" + number[i] + "'>"+"<input type='hidden' name='name[]' value='" + name[i] + "'>"+"<input type='hidden' name='duration[]' value='" + duration[i] + "'>");
        }
      });

    </script>

    <script type="text/javascript">
      $(function(){
        $('body').on('click', 'tr',function(e){
        $("tr[class=table-primary]").removeClass("table-primary");
            
        $(this).addClass("table-primary"); 
         //alert("fgdf");
        });
      });

      $(function(){
        $('#delete').bind('click', function(e){
          $("tr[class=table-primary]").remove();
          /*var trs=$("th[scope=row]");
          for (var i=0;i<trs.length;i++)
            $(trs[i]).text(i+1);*/

          var trs=$('tr');
          console.log(trs.length);
          for (var i=1;i<trs.length;i++)
          {
            $(trs[i]).attr('id-entry',i);
            console.log($(trs[i]).children()[0].textContent=i);
          }

        });
      });


      $(function(){
        $('#edit').bind('click', function(e){
          $('#insertIntoTable').css('display','none');
          $('#updateEntry').css('display','block');
          var curPos=$("tr[class=table-primary]");
          if(curPos.length!=0)
            {
              var children=$(curPos[0]).children();
              $('#updateEntry').attr('id-entry',children[0].innerText);
              $('#songName').val(children[1].innerText);
              var time=children[2].innerText.split(':');
              $('#songMin').val(time[0]);
              $('#songSec').val(time[1]);
            }
        });
      });

      $(function(){
        $('#add').bind('click', function(e){
          $('#songName').val('');
          $('#songMin').val('');
          $('#songSec').val('');
          $('#insertIntoTable').css('display','block');
          $('#updateEntry').css('display','none');
        });
      });
    </script>

    <script type="text/javascript">
      //работа с загрузкой изображеий
      // загрузка обложки альбома
      $('#fileImageCover').bind('change', function(e){
        console.log($(this).val());

         var reader = new FileReader();
         reader.onload=function(e){
          $('#ImageCover').attr('src', e.target.result);
         }
         reader.readAsDataURL(this.files[0]);
      });

      $('#deleteImageCover').bind('click', function(e){
        $('#ImageCover').attr('src', '');
        var $fImageCover=$('#fileImageCover');
        //console.log(document.getElementById('fileImageCover').files);
        $fImageCover.val('');
        //console.log(document.getElementById('fileImageCover').files);
      });

      // загрузка дополнительных изображений
      $('#fileImageAdditions').bind('change', function(e){
        deletePromise()
            .then(()=>{

                var files = this.files;

                if (files.length>0)
                {
                  for(var i=0;i<files.length;i++){
                    console.log(files[i].name);

                      var reader = new FileReader();
                      reader.onload = (function(theFile, i) {
                        return function(e) {
                          console.log(i);

                          $('.carousel-inner').append('<div class="carousel-item '+(i==0?'active':'')+'">'+
                                      '<img class="d-block w-100 alb-cover" src="'+e.target.result+'">'+
                                    '</div>');
                          $(".carousel-indicators").append('<li data-target="#carouselAdditionalImages" data-slide-to="'+i+'"></li>');
                          $("#inputGroupSelectImgNames").append('<option class="imgName" '+(i==0?'selected':'')+'>'+theFile.name+'</option>');
                        };
                      })(files[i], i);

                    reader.readAsDataURL(files[i], i); 
                  }
                }
                console.log(document.getElementById('fileImageAdditions').files);
              })
      });

      $('#deleteImageAdditionals').bind('click', function(e){
        $(".imgName").remove();
        $(".carousel-item").remove();
        $(".carousel-indicators>li").remove();
        
        console.log(document.getElementById('fileImageAdditions').files);
        $('#fileImageAdditions').val('');
        console.log(document.getElementById('fileImageAdditions').files);
      });

      var deletePromise=function(){
        return new Promise(function(resolve,reject){

          $(".imgName").remove();
          $(".carousel-item").remove();
          $(".carousel-indicators>li").remove();
          //console.log(document.getElementById('fileImageAdditions').files);
          resolve();
        });
      }


      $('#deleteIm').bind('click', function(e){
        console.log($('#fileImageCover').val());
        if ($('#fileImageCover').val()=="")
          console.log("empty!");
      });
      

    </script>

  </body>
</html>